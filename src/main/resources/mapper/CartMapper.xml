<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qbk.web.mapper.CartMapper">

    <!-- 购物车表字段 -->
    <resultMap id="CartResultMap" type="com.qbk.entity.Cart">
        <id column="id" property="id" />
        <result column="user_id" property="userId" />
        <result column="temp_cart_key" property="tempCartKey" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
    </resultMap>

    <!-- 购物车商品项表字段 -->
    <resultMap id="CartItemResultMap" type="com.qbk.entity.CartItem">
        <id column="id" property="id" />
        <result column="cart_id" property="cartId" />
        <result column="user_id" property="userId" />
        <result column="product_id" property="productId" />
        <result column="product_name" property="productName" />
        <result column="price" property="price" />
        <result column="quantity" property="quantity" />
        <result column="stock" property="stock" />
        <result column="image" property="image" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
    </resultMap>

    <!-- 根据用户ID查询购物车 -->
    <select id="selectCartByUserId" resultMap="CartResultMap">
        SELECT * FROM cart WHERE user_id = #{userId}
    </select>

    <!-- 根据临时购物车标识查询购物车 -->
    <select id="selectCartByTempKey" resultMap="CartResultMap">
        SELECT * FROM cart WHERE temp_cart_key = #{tempCartKey}
    </select>

    <!-- 插入购物车 -->
    <insert id="insertCart" parameterType="com.qbk.entity.Cart" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO cart (user_id, temp_cart_key, create_time, update_time)
        VALUES (#{userId}, #{tempCartKey}, #{createTime}, #{updateTime})
    </insert>

    <!-- 更新购物车 -->
    <update id="updateCart" parameterType="com.qbk.entity.Cart">
        UPDATE cart SET
        user_id = #{userId},
        temp_cart_key = #{tempCartKey},
        update_time = #{updateTime}
        WHERE id = #{id}
    </update>

    <!-- 删除购物车 -->
    <delete id="deleteCart">
        DELETE FROM cart WHERE id = #{id}
    </delete>

    <!-- 根据购物车ID查询购物车商品项 -->
    <select id="selectCartItemsByCartId" resultMap="CartItemResultMap">
        SELECT * FROM cart_item WHERE cart_id = #{cartId}
    </select>

    <!-- 根据用户ID查询购物车商品项 -->
    <select id="selectCartItemsByUserId" resultMap="CartItemResultMap">
        SELECT * FROM cart_item WHERE user_id = #{userId}
    </select>

    <!-- 插入购物车商品项 -->
    <insert id="insertCartItem" parameterType="com.qbk.entity.CartItem" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO cart_item (cart_id, user_id, product_id, product_name, price, quantity, stock, image, create_time, update_time)
        VALUES (#{cartId}, #{userId}, #{productId}, #{productName}, #{price}, #{quantity}, #{stock}, #{image}, #{createTime}, #{updateTime})
    </insert>

    <!-- 更新购物车商品项 -->
    <update id="updateCartItem" parameterType="com.qbk.entity.CartItem">
        UPDATE cart_item SET
        cart_id = #{cartId},
        user_id = #{userId},
        product_id = #{productId},
        product_name = #{productName},
        price = #{price},
        quantity = #{quantity},
        stock = #{stock},
        image = #{image},
        update_time = #{updateTime}
        WHERE id = #{id}
    </update>

    <!-- 删除购物车商品项 -->
    <delete id="deleteCartItem">
        DELETE FROM cart_item WHERE id = #{id}
    </delete>

    <!-- 根据购物车ID清空购物车商品项 -->
    <delete id="clearCartItems">
        DELETE FROM cart_item WHERE cart_id = #{cartId}
    </delete>

    <!-- 根据用户ID和商品ID查询购物车商品项 -->
    <select id="selectCartItemByUserIdAndProductId" resultMap="CartItemResultMap">
        SELECT * FROM cart_item WHERE user_id = #{userId} AND product_id = #{productId}
    </select>

</mapper>
